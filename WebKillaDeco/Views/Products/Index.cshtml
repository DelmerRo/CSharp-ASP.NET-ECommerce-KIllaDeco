@model WebKillaDeco.ViewModels.ProductCategoryViewModel
@{
    ViewData["Title"] = "Index";
}

<!-- Estilos CSS -->
<style>
    .single-product-wrapper {
        margin-bottom: 30px;
        border: 1px solid #ddd;
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

        .single-product-wrapper:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

    .product-img {
        height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }

        .product-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s;
        }

        .product-img .hover-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, visibility 0.5s;
            object-fit: cover;
        }

    .single-product-wrapper:hover .hover-img {
        opacity: 1;
        visibility: visible;
    }

    .product-description {
        padding: 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .product-price {
        font-size: 1.25rem;
        font-weight: bold;
    }

    .product-meta-data h6 {
        margin: 0;
        font-size: 1.1rem;
        color: #333;
    }

    .ratings i {
        color: #ffcc00;
    }

    .cart img {
        width: 24px;
        height: 24px;
    }
    /* Estilos para la categoría principal */
    .category-link {
        font-weight: bold;
        color: #333; /* Color más oscuro para las categorías */
    }

    /* Estilos para las subcategorías */
    .subcategory-link {
        color: #666; /* Color más claro para las subcategorías */
        font-size: 0.9rem; /* Tamaño de fuente ligeramente más pequeño */
        padding-left: 30px; /* Espacio adicional a la izquierda para indentación */
    }
    /* Estilos para la categoría principal */
    .category-link {
        display: block;
        font-weight: bold;
        color: #333; /* Color más oscuro para las categorías */
        padding: 10px 15px;
        border-bottom: 1px solid #ddd; /* Borde inferior para separar las categorías */
        transition: background-color 0.3s ease;
    }

        .category-link:hover {
            background-color: #f5f5f5; /* Color de fondo al pasar el ratón */
        }

    /* Estilos para las subcategorías */
    .subcategory-list {
        display: none; /* Oculta por defecto las subcategorías */
        list-style: none;
        padding-left: 0;
        margin-top: 0;
        margin-bottom: 0;
    }

        .subcategory-list li {
            padding-left: 20px; /* Indentación para subcategorías */
        }

    .subcategory-link {
        display: block;
        padding: 10px 30px; /* Espaciado de las subcategorías */
        color: #666; /* Color más claro para las subcategorías */
        transition: background-color 0.3s ease;
    }

        .subcategory-link:hover {
            background-color: #f0f0f0; /* Color de fondo al pasar el ratón */
        }

</style>

<!-- Contenido HTML -->
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-2 bg-light">
            <!-- Sidebar -->
            <div class="shop_sidebar_area">
                <!-- Widget Categorías -->
                <div class="widget catagory mb-50">
                    <h6 class="widget-title mb-30">Categorías</h6>
                    <div class="catagories-menu">
                        <ul>
                            @if (Model.Categories != null && Model.Categories.Any())
                            {
                                @foreach (var category in Model.Categories)
                                {
                                    <li>
                                        <a href="#" class="category-link">@category.Name</a>
                                        @if (category.SubCategories.Any())
                                        {
                                            <ul class="subcategory-list">
                                                @foreach (var subcategory in category.SubCategories)
                                                {
                                                    <li>
                                                        <a href="#" class="subcategory-link" data-subcategory-id="@subcategory.SubCategoryId">@subcategory.Name</a>
                                                    </li>
                                                }
                                            </ul>
                                        }
                                    </li>
                                }
                            }
                            else
                            {
                                <li>No hay categorías disponibles</li>
                            }
                        </ul>
                    </div>




                </div>

                <!-- ##### Single Widget ##### -->
                <div class="widget brands mb-50">
                    <!-- Widget Title -->
                    <h6 class="widget-title mb-30">Brands</h6>
                    <div class="widget-desc">
                        @foreach (var brand in Model.Brands)
                        {
                            <div class="form-check">
                                <input class="form-check-input brand-checkbox" type="checkbox" value="@brand" id="checkbox-@brand">
                                <label class="form-check-label" for="checkbox-@brand">@brand</label>
                            </div>
                        }
                    </div>
                </div>


                <!-- ##### Single Widget ##### -->
                <div class="widget color mb-50">
                    <!-- Widget Title -->
                    <h6 class="widget-title mb-30">Color</h6>
                    <div class="widget-desc">
                        <ul class="d-flex">
                            <li><a href="#" class="color1"></a></li>
                            <li><a href="#" class="color2"></a></li>
                            <li><a href="#" class="color3"></a></li>
                            <li><a href="#" class="color4"></a></li>
                            <li><a href="#" class="color5"></a></li>
                            <li><a href="#" class="color6"></a></li>
                            <li><a href="#" class="color7"></a></li>
                            <li><a href="#" class="color8"></a></li>
                        </ul>
                    </div>
                </div>

                <!-- ##### Single Widget ##### -->
                <div class="widget price mb-50">
                    <!-- Widget Title -->
                    <h6 class="widget-title mb-30">Price</h6>
                    <div class="widget-desc">
                        <div class="slider-range">
                            <div data-min="10" data-max="1000" data-unit="$" class="slider-range-price ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" data-value-min="10" data-value-max="1000" data-label-result="">
                                <div class="ui-slider-range ui-widget-header ui-corner-all"></div>
                                <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                                <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                            </div>
                            <div class="range-price">$10 - $1000</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="col-lg-10">
            <!-- Contenido principal -->
            <div id="product-list" class="row">
                @foreach (var product in Model.Products)
                {
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-3">
                        <div class="card single-product-wrapper">
                            <div class="product-img">
                                <img src="@Url.Content(product.ImageUrl)" alt="@product.Name Image">
                                <img class="hover-img" src="@Url.Content(product.ImageUrl1)" alt="">
                            </div>
                            <div class="product-description card-body">
                                <div class="product-meta-data">
                                    <div class="line"></div>
                                    <p class="product-price">USD @product.CurrentPrice</p>
                                    <a href="@Url.Action("Details", "Products", new { id = product.ProductId })">
                                        <h6>@product.Name</h6>
                                    </a>
                                </div>
                                <div class="ratings-cart text-right">
                                    <div class="ratings">
                                        <i class="fa fa-star" aria-hidden="false"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                        <i class="fa fa-star" aria-hidden="true"></i>
                                    </div>
                                    <div class="cart">
                                        <a href="@Url.Action("AddToCart", "Cart", new { id = product.ProductId })" data-toggle="tooltip" data-placement="left" title="Add to Cart">
                                            <img src="@Url.Content("~/client/img/core-img/cart.png")" alt="">
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Paginación -->
            <div class="row">
                <div class="col-12">
                    <nav aria-label="navigation">
                        <ul class="pagination justify-content-end mt-50">
                            <!-- Aquí van los botones de paginación -->
                            <li class="page-item active"><a class="page-link" href="#">01.</a></li>
                            <li class="page-item"><a class="page-link" href="#">02.</a></li>
                            <li class="page-item"><a class="page-link" href="#">03.</a></li>
                            <li class="page-item"><a class="page-link" href="#">04.</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Función para manejar el cambio en los checkboxes de marcas
            $('.brand-checkbox').change(function () {
                var selectedBrands = [];
                $('.brand-checkbox:checked').each(function () {
                    selectedBrands.push($(this).val());
                });
                loadProductsByBrands(selectedBrands);
            });

            // Función para manejar el clic en los enlaces de categoría
            $('.category-link').click(function (e) {
                e.preventDefault();

                var $this = $(this);
                var $subcategoryList = $this.next('.subcategory-list');

                // Contraer todas las subcategorías excepto la que se va a desplegar
                $('.subcategory-list').not($subcategoryList).slideUp();

                // Alternar despliegue de la subcategoría correspondiente
                $subcategoryList.slideToggle();
            });

            // Función para manejar el clic en los enlaces de subcategoría
            $('.subcategory-link').click(function (e) {
                e.preventDefault();
                var subcategoryId = $(this).data('subcategory-id');
                loadProductsBySubcategory(subcategoryId);
            });

            // Función para cargar productos por subcategoría mediante AJAX
            function loadProductsBySubcategory(subcategoryId) {
                $.ajax({
                    url: '@Url.Action("GetProductsBySubcategory", "Products")',
                    type: 'GET',
                    data: { subcategoryId: subcategoryId },
                    success: function (result) {
                        $('#product-list').html(result); // Actualiza el contenido de #product-list con los productos devueltos
                    },
                    error: function (error) {
                        console.error('Error al cargar productos:', error);
                    }
                });
            }

            // Función para cargar productos por marcas mediante AJAX
            function loadProductsByBrands(brands) {
                $.ajax({
                    url: '@Url.Action("GetProductsByBrand", "Products")',
                    type: 'GET',
                    data: { brands: brands },
                    traditional: true, // Necesario si usas jQuery 1.4.4 o anterior
                    success: function (result) {
                        $('#product-list').html(result); // Actualiza el contenido de #product-list con los productos devueltos
                    },
                    error: function (error) {
                        console.error('Error al cargar productos:', error);
                    }
                });
            }
        });
    </script>
}

}

